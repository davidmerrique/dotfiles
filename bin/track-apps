#!/bin/sh

DIR="$HOME/Dropbox/activity_log/apps"
FILE="$DIR/`date +%Y%m%d`.log"

function log_app() {
  if [[ ! -f $FILE ]]; then
    if [[ ! -d $DIR ]]; then
      mkdir -p $DIR
    fi
    touch $FILE
  fi

  local TIME=`date "+%T"`
  local SCREEN=local SCREEN=$(/usr/bin/osascript -e 'tell application "System Events"' -e "set powerState to do shell script \"ioreg -n IODisplayWrangler |grep -i IOPowerManagement"\" -e 'end tell')
  local ACTIVE_PROGRAM=$(/usr/bin/osascript -e 'tell application "System Events"' -e 'set frontApp to name of first application process whose frontmost is true' -e 'end tell')

  if [[ $SCREEN == *\"CurrentPowerState\"=4* ]]; then
    echo "$TIME,$ACTIVE_PROGRAM" >> $FILE
  fi
}

log_app
sleep 30
log_app
